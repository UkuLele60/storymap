<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Quiz cartographique - Où est Ouidah ?</title>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Nunito:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Nunito", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: #f5f5f5;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* ---- BANDEAU AVEC TEXTE CENTRÉ ET DRAPEAUX GAUCHE/DROITE ---- */
    header {
      padding: 0.75rem 1.25rem;
      border-bottom: 2px solid #e0e0e0;
      background: linear-gradient(90deg, rgba(0,135,81,0.12), rgba(252,209,22,0.08));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      text-align: center;
    }

    .flag {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 48px;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      border: 2px solid #ffffff;
      background: white;
    }
    #flag-left { left: 12px; }
    #flag-right { right: 12px; }

    #header-content {
      max-width: 600px;
    }

    #subtitle {
      font-size: 0.9rem;
      color: #333;
      font-weight: 600;
    }
    #subtitle span {
      color: #e8112d;
    }

    h1 {
      font-family: "Poppins", sans-serif;
      font-size: 1.4rem;
      margin: 0.2rem 0;
      letter-spacing: 0.02em;
      font-weight: 800;
      color: #008751;
      text-transform: uppercase;
    }

	.mini-title {
		font-family: "Poppins", sans-serif; /* comme le h1 */
		font-weight: 700;                   /* un peu moins que le H1 */
		font-size: 1.05rem;                 /* plus petit que le titre principal */
		letter-spacing: 0.5px;
		text-transform: uppercase;
		color: #008751;                     /* même vert que le h1 */
	}


    #instructions {
      font-size: 0.9rem;
      color: #444;
      margin-top: 0.35rem;
    }

    /* ---- Message ---- */
    #message {
      margin-top: 0.45rem;
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      display: inline-block;
      background: #fff8e1;
      color: #c27800;
      border: 1px solid #ffe4a0;
    }
    #message.ok {
      background: #e5f9ef;
      color: #0b7a3b;
      border-color: #a8e5c4;
    }
    #message.ko {
      background: #ffe9e9;
      color: #c62828;
      border-color: #ffb3b3;
    }

    /* ---- Boutons ---- */
    #controls {
      margin-top: 0.5rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    #controls button {
      font-size: 0.8rem;
      padding: 0.3rem 0.75rem;
      cursor: pointer;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      background: #fcd116;
      color: #2b2b2b;
      box-shadow: 0 1px 3px rgba(0,0,0,0.18);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }
    #controls button:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.25);
      background: #ffe46b;
    }

    #map {
      flex: 1;
      background: #ffffff;
    }

    /* ---- Overlays d'effets ---- */

    .fx-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.25s ease-out;
      z-index: 9999;
    }

    .fx-overlay.visible {
      opacity: 1;
    }

    /* Effet victoire */
    #fx-win {
      background: radial-gradient(circle at center, rgba(255,255,255,0.9), rgba(0,135,81,0.2));
    }
    #fx-win-content {
      text-align: center;
      padding: 1.5rem 2rem;
      border-radius: 18px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      animation: pop-in 0.4s ease-out;
    }
    #fx-win-title {
      font-family: "Poppins", sans-serif;
      font-size: 1.6rem;
      font-weight: 800;
      color: #008751;
      margin-bottom: 0.3rem;
    }
    #fx-win-sub {
      font-size: 0.95rem;
      color: #333;
    }

    @keyframes pop-in {
      from { transform: scale(0.7); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    /* Effet défaite */
    #fx-lose {
      background: radial-gradient(circle at center, rgba(255,255,255,0.9), rgba(200,0,0,0.3));
    }
    #fx-lose-content {
      text-align: center;
      padding: 1.3rem 1.8rem;
      border-radius: 18px;
      background: rgba(255,255,255,0.98);
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      animation: shake-in 0.4s ease-out;
    }
    #fx-lose-title {
      font-family: "Poppins", sans-serif;
      font-size: 1.4rem;
      font-weight: 800;
      color: #c62828;
      margin-bottom: 0.3rem;
    }
    #fx-lose-sub {
      font-size: 0.95rem;
      color: #444;
    }

    @keyframes shake-in {
      0%   { transform: translateX(0); }
      20%  { transform: translateX(-6px); }
      40%  { transform: translateX(6px); }
      60%  { transform: translateX(-4px); }
      80%  { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    /* Petit shake du body pour la défaite */
    .shake {
      animation: body-shake 0.4s ease-out;
    }

    @keyframes body-shake {
      0%   { transform: translateX(0); }
      20%  { transform: translateX(-3px); }
      40%  { transform: translateX(3px); }
      60%  { transform: translateX(-2px); }
      80%  { transform: translateX(2px); }
      100% { transform: translateX(0); }
    }

  </style>
</head>
<body>
<div id="app">
  <header>
    <img id="flag-left" class="flag" src="https://www.drapeaux-du-monde.fr/drapeaux-du-monde/3000/drapeau-benin.jpg" alt="Drapeau gauche">
    <div id="header-content">
      <h1>Où se trouve Ouidah ?</h1>
      <div id="instructions">
  <span class="mini-title">Clique sur la Carte</span><br>
  Tu dois être à moins de <strong>15 km</strong> pour réussir.
</div>

      <div id="message">En attente de ta première réponse…</div>
      <div id="controls">
        <!-- Afficher à gauche, Recommencer à droite -->
        <button id="show-answer">Afficher la bonne réponse</button>
        <button id="restart">Recommencer</button>
      </div>
    </div>
    <img id="flag-right" class="flag" src="https://www.drapeaux-du-monde.fr/drapeaux-du-monde/3000/drapeau-benin.jpg" alt="Drapeau droite">
  </header>

  <div id="map"></div>
</div>

<!-- Overlays d'effets -->
<div id="fx-win" class="fx-overlay">
  <div id="fx-win-content">
    <div id="fx-win-title">Bravo&nbsp;!</div>
    <div id="fx-win-sub">Tu as trouvé Ouidah. <br>Tu peux continuer ta découverte de la Route de l'esclave.</div>
  </div>
</div>

<div id="fx-lose" class="fx-overlay">
  <div id="fx-lose-content">
    <div id="fx-lose-title">Oups…</div>
    <div id="fx-lose-sub">Tu es un peu trop loin de Ouidah.</div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<!-- Turf.js -->
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<!-- Confettis (canvas-confetti) -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.0/dist/confetti.browser.min.js"></script>

<script>
  // Coordonnées de Ouidah
  const ouidahLat = 6.3640;
  const ouidahLng = 2.0851;
  const targetPoint = turf.point([ouidahLng, ouidahLat]);

  const toleranceKm = 15;

  // Carte centrée sur l'Afrique de l'Ouest
  const map = L.map('map').setView([7.5, 1.5], 6);

  // Fond sobre sans labels (toujours visible)
  const baseLayer = L.tileLayer(
    "https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",
    { attribution: "&copy; CartoDB (no labels)", maxZoom: 19 }
  ).addTo(map);

  // Fond détaillé OSM (ajouté uniquement après clic / réponse)
  let detailedLayer = null;

  let clickMarker = null;
  let answerMarker = null;

  const messageDiv = document.getElementById('message');
  const fxWin = document.getElementById('fx-win');
  const fxLose = document.getElementById('fx-lose');

  // Compteur de tentatives
  let attemptNumber = 1;

  function getAttemptLabel(n) {
    if (n === 1) return "première";
    if (n === 2) return "deuxième";
    if (n === 3) return "troisième";
    if (n === 4) return "quatrième";
    if (n === 5) return "cinquième";
    return n + "e";
  }

  function resetMessage() {
    const label = getAttemptLabel(attemptNumber);
    setMessage(`En attente de ta ${label} réponse…`, null);
  }

  function setMessage(text, status) {
    messageDiv.textContent = text;
    messageDiv.classList.remove("ok", "ko");
    if (status === "ok") messageDiv.classList.add("ok");
    if (status === "ko") messageDiv.classList.add("ko");
  }

  function hideEffects() {
    fxWin.classList.remove('visible');
    fxLose.classList.remove('visible');
    document.body.classList.remove('shake');
  }

  // Effet victoire
  function triggerWinEffect() {
    hideEffects();
    fxWin.classList.add('visible');

    const duration = 1500;
    const end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 60,
        spread: 70,
        origin: { x: Math.random() * 0.4 + 0.3, y: 0.2 }
      });
      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();

    setTimeout(() => {
      fxWin.classList.remove('visible');
    }, 2000);
  }

  // Effet défaite
  function triggerLoseEffect() {
    hideEffects();
    fxLose.classList.add('visible');
    document.body.classList.add('shake');

    setTimeout(() => {
      fxLose.classList.remove('visible');
      document.body.classList.remove('shake');
    }, 1200);
  }

  // Ajoute le fond détaillé OSM si pas déjà présent
  function ensureDetailedLayer() {
    if (!detailedLayer) {
      detailedLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        { attribution: "&copy; OpenStreetMap contributors", maxZoom: 19 }
      ).addTo(map);
    }
  }

  // Clic sur la carte
  map.on('click', function (e) {
    const lat = e.latlng.lat;
    const lng = e.latlng.lng;

    // Au premier clic, on affiche le fond détaillé
    ensureDetailedLayer();

    if (clickMarker) map.removeLayer(clickMarker);
    clickMarker = L.marker([lat, lng]).addTo(map);

    const distance = turf.distance(turf.point([lng, lat]), targetPoint, { units: "kilometers" });
    const d = Math.round(distance * 10) / 10;

    if (distance <= toleranceKm) {
      setMessage(`Bravo ! Tu es à ${d} km de Ouidah.`, "ok");
      triggerWinEffect();
    } else {
      setMessage(`Tu es à ${d} km de Ouidah.`, "ko");
      triggerLoseEffect();
    }
  });

  // Bouton "Afficher la bonne réponse"
  document.getElementById('show-answer').addEventListener('click', () => {
    // On s'assure aussi de montrer le fond détaillé
    ensureDetailedLayer();

    if (answerMarker) map.removeLayer(answerMarker);
    answerMarker = L.marker([ouidahLat, ouidahLng])
      .addTo(map)
      .bindPopup("Ouidah (bonne réponse)")
      .openPopup();
    map.setView([ouidahLat, ouidahLng], 10);
  });

  // Bouton "Recommencer"
  document.getElementById('restart').addEventListener('click', () => {
    if (clickMarker) { map.removeLayer(clickMarker); clickMarker = null; }
    if (answerMarker) { map.removeLayer(answerMarker); answerMarker = null; }

    // On enlève le fond détaillé pour revenir au fond "sobre"
    if (detailedLayer) {
      map.removeLayer(detailedLayer);
      detailedLayer = null;
    }

    map.setView([7.5, 1.5], 6);
    hideEffects();

    attemptNumber += 1;
    resetMessage();
  });

  // Message initial
  resetMessage();
</script>
</body>
</html>


